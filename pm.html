<!DOCTYPE html>
<html>

<head>
        <meta charset="UTF-8" />
        <title>プレイ画面</title>
        <script type="text/javascript" src="define.js"> </script>
        <script src="https://code.jquery.com/jquery-1.9.0.min.js"></script>
        <script type="text/javascript" src="jquery.balloon.js"></script>
        <style>
                .block1 {
                        background: rgb(209, 231, 255);
                        width: 60%;
                        font-size: 20px;
                        padding: 0.5em 0.5em;
                        position: relative;
                        left: 7%;
                        word-break: break-all;
                }

                .block2 {
                        background: rgb(236, 245, 255);
                        width: 60%;
                        font-size: 20px;
                        padding: 0.5em 0.5em;
                        position: relative;
                        left: 7%;
                        word-break: break-all;
                }


                textarea {
                        width: 70%;
                        resize: none;
                        position: relative;
                        left: 70px;
                }

                .textarea_smoll {
                        width: 70%;
                        height: 60px;
                        position: relative;
                        left: 55px;
                }

                draw_area {
                        width: 70%;
                        height: auto;
                        position: relative;
                        left: 0px;
                }

                .theme_box {
                        padding: 0.5em 1em;
                        color: #000000;
                        background: #9ee7a8;
                        border-bottom: solid 6px #7cf090;
                        border-radius: 9px;
                        width: 25%;
                        height: 100px;
                        position: absolute;
                        left: 70%;
                }


                .hide_black {
                        background: #000000;
                        opacity: 0.7;
                        width: 100%;
                        height: 100%;
                        position: fixed;
                        top: 0px;
                        left: 0px;
                        z-index: 1;
                }

                .tag_b {
                        color: #364e96;
                        /*文字色*/
                        padding: 0.5em 1em;
                        /*上下の余白*/
                        border-top: solid 3px #364e96;
                        /*上線*/
                        border-bottom: solid 3px #364e96;
                        /*下線*/
                        width: 200px;
                        font-size: 20px;
                        text-decoration: none;
                }

                .tag_b:hover {
                        color: #364e96;
                        /*文字色*/
                        padding: 0.5em 1em;
                        /*上下の余白*/
                        border-top: solid 3px #364e96;
                        /*上線*/
                        border-bottom: solid 3px #364e96;
                        /*下線*/
                        width: 200px;
                        font-size: 25px;
                        text-decoration: none;
                }

                .tag_r {
                        color: #af2626;
                        /*文字色*/
                        padding: 0.5em 1em;
                        /*上下の余白*/
                        border-top: solid 3px #af2626;
                        /*上線*/
                        border-bottom: solid 3px #af2626;
                        /*下線*/
                        width: 200px;
                        font-size: 20px;
                        text-decoration: none;
                }

                .cp_ipradio {
                        width: 90%;
                        margin: 2em auto;
                        text-align: left;
                }

                .cp_ipradio input[type='radio'] {
                        position: absolute;
                        z-index: -1;
                        opacity: 0;
                }

                .cp_ipradio label {
                        position: relative;
                        display: inline-block;
                        margin-right: 30px;
                        padding-right: 10px;
                        padding-left: 35px;
                        cursor: pointer;
                }

                .cp_ipradio label::before {
                        position: absolute;
                        z-index: -1;
                        top: 0;
                        left: 0;
                        display: block;
                        width: 24px;
                        height: 24px;
                        content: ' ';
                        border: 2px solid #da3c41;
                        /* border-radius: 4px; */
                }

                .cp_ipradio input[type='radio']+label::before {
                        border-radius: 18px;
                }

                .cp_ipradio input[type='radio']:checked+label {
                        padding-left: 10px;
                        color: #ffffff;
                }

                .cp_ipradio input[type='radio']:checked+label::before {
                        top: 0;
                        width: 100%;
                        height: 100%;
                        background: #da3c41;
                }

                /* Transition */
                .cp_ipradio label,
                .cp_ipradio label::before {
                        -webkit-transition: 0.25s all ease;
                        transition: 0.25s all ease;
                }
        </style>
        <script>


                $('texi_and_pop').balloon();//マウスオーバーの割り当て

                var assessment_data = [];
                //受信
                $(document).ready(function () {
                        window.sessionStorage.setItem(["eventcode"], "5SrgaP0MjG");
                        get_theme_detail();

                        var list = '<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>';

                        if (DEBUG)
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                code: window.sessionStorage.getItem(["eventcode"])
                                        },
                                        success: function (data1) {
                                                // alert(data1);
                                                $.ajax({ //非同期通信
                                                        type: "POST",
                                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/theme.php",
                                                        data: {
                                                                id: data1
                                                        },
                                                        success: function (data) {
                                                                var text1 = '<br><a style="position: relative;left: 140px;">';
                                                                var text2 = '：</a><select id="assessment_list';
                                                                var text3 = '" style="position: relative;width: 50px;left: 158px;">';

                                                                var add = "";
                                                                add += '<a style="position: relative;left: 40px;">' + data[0].assessment0 + '：</a>';
                                                                add += '<select id="assessment_list' + 0 + '" style="position: relative;width: 50px;left: 60px;">';
                                                                $("#assessment_list").append(add + list);
                                                                assessment_data.push(data[0].assessment0);
                                                                if (data[0].assessment1 != "") { $("#assessment_list").append(text1 + data[0].assessment1 + text2 + 1 + text3 + list); assessment_data.push(data[0].assessment1); }
                                                                if (data[0].assessment2 != "") { $("#assessment_list").append(text1 + data[0].assessment2 + text2 + 2 + text3 + list); assessment_data.push(data[0].assessment2); }
                                                                if (data[0].assessment3 != "") { $("#assessment_list").append(text1 + data[0].assessment3 + text2 + 3 + text3 + list); assessment_data.push(data[0].assessment3); }
                                                                if (data[0].assessment4 != "") { $("#assessment_list").append(text1 + data[0].assessment4 + text2 + 4 + text3 + list); assessment_data.push(data[0].assessment4); }
                                                                if (data[0].assessment5 != "") { $("#assessment_list").append(text1 + data[0].assessment5 + text2 + 5 + text3 + list); assessment_data.push(data[0].assessment5); }
                                                                if (data[0].assessment6 != "") { $("#assessment_list").append(text1 + data[0].assessment6 + text2 + 6 + text3 + list); assessment_data.push(data[0].assessment6); }
                                                                if (data[0].assessment7 != "") { $("#assessment_list").append(text1 + data[0].assessment7 + text2 + 7 + text3 + list); assessment_data.push(data[0].assessment7); }
                                                                if (data[0].assessment8 != "") { $("#assessment_list").append(text1 + data[0].assessment8 + text2 + 8 + text3 + list); assessment_data.push(data[0].assessment8); }
                                                                if (data[0].assessment9 != "") { $("#assessment_list").append(text1 + data[0].assessment9 + text2 + 9 + text3 + list); assessment_data.push(data[0].assessment9); }

                                                        },
                                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                                // alert('エラーです！'); //エラーを表示
                                                                console.log("えらー:" + textStatus);
                                                        }
                                                });
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                        }
                                });

                        if (DEBUG)
                                get_history();
                });

                //テーマの詳細を受信
                function get_theme_detail() {
                        if (DEBUG)
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                code: window.sessionStorage.getItem(["eventcode"])
                                        },
                                        success: function (data1) {
                                                // alert(data1);
                                                $.ajax({ //非同期通信
                                                        type: "POST",
                                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/theme.php",
                                                        data: {
                                                                id: data1
                                                        },
                                                        success: function (data) {
                                                                console.log(data);
                                                                // タイトル
                                                                $("#theme_title_text").empty();
                                                                $("#theme_title_text").append(data[0].title);
                                                                // カテゴリー
                                                                $("#theme_category_text").empty();
                                                                $("#theme_category_text").append(data[0].category);

                                                                //状況
                                                                $("#theme_situation_text").empty();
                                                                $("#theme_situation_text").append(data[0].situation);
                                                                // 評価項目
                                                                $("#theme_assessment_text").empty();
                                                                $("#theme_assessment_text").append(data[0].assessment0);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment1);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment2);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment3);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment4);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment5);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment6);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment7);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment8);
                                                                $("#theme_assessment_text").append("&nbsp;&nbsp;&nbsp;&nbsp;" + data[0].assessment9);
                                                                // 日時・時期
                                                                $("#theme_time_text").empty();
                                                                $("#theme_time_text").append(data[0].time);

                                                                // 地域
                                                                $("#theme_area_text").empty();
                                                                $("#theme_area_text").append(data[0].area);



                                                                // 対象者
                                                                $("#theme_target_text").empty();
                                                                $("#theme_target_text").append(data[0].target);

                                                                // ねらい
                                                                $("#theme_aim_text").empty();
                                                                $("#theme_aim_text").append(data[0].aim);

                                                                // 公開の可否
                                                                $("#theme_open_text").empty();
                                                                $("#theme_open_text").append(data[0].open);
                                                                // 画像
                                                                $("#theme_image_text").empty();
                                                                // $("#image_text").append(data[0].image);
                                                                if (data[0].image != "" && data[0].image != null)
                                                                        $("#theme_image_text").append('<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data[0].image + '">');
                                                                receive_flag = 0;
                                                        },
                                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                                // alert('エラーです！'); //エラーを表示
                                                                console.log("えらー:" + textStatus);

                                                        }
                                                });
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                                console.log("えらー:" + textStatus);

                                        }
                                });
                }

                //履歴データの受信と表示
                function get_history() {
                        var first_human_card_data = 1, first_situation_card_data = 1;
                        $.ajax({ //非同期通信
                                type: "POST",
                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                data: {
                                        code: window.sessionStorage.getItem(["eventcode"]),
                                        id: "2"
                                },
                                success: function (data) {
                                        $.ajax({ //非同期通信
                                                type: "POST",
                                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                                data: {
                                                        code: window.sessionStorage.getItem(["eventcode"]),
                                                        id: "3"
                                                },
                                                success: function (data1) {

                                                        data = data.concat(data1);
                                                        data.sort(function (a, b) {
                                                                if (a.num < b.num) return -1;
                                                                if (a.num > b.num) return 1;
                                                                return 0;
                                                        });
                                                        console.log(data);
                                                        var add = "", class_name, color;
                                                        for (var i = data.length - 1; i > -1; i--) {
                                                                if (data[i].id == "2") {
                                                                        class_name = "block1";
                                                                        color = "#f7fdc4";
                                                                }
                                                                else if (data[i].id == "3") {
                                                                        class_name = "block2";
                                                                        color = "#fff8ef";
                                                                }

                                                                //全ての履歴
                                                                if (i != data.length - 1)
                                                                        add = "<div class='" + class_name + "' style='width:90%;left:4%;font-size: 13px;border:1px solid green;border-top:0px solid green;background: " + color + ";'>";
                                                                else
                                                                        add = "<div class='" + class_name + "' style='width:90%;left:4%;font-size: 13px;border:1px solid green;background: " + color + ";'>";
                                                                add += set_history_data(data[i], "all");
                                                                // console.log(set_history_data(data[i]));
                                                                add += "</div> ";
                                                                $("#situation_detail_box_add").append(add);
                                                                //再利用
                                                                if (first_human_card_data == 1 && data[i].id == "3") {
                                                                        add = "<div class='" + class_name + "' style='width:60%;left:7%;font-size: 13px;border:1px solid green;background: " + color + ";'>";
                                                                        first_human_card_data = 0;
                                                                }
                                                                else if (first_situation_card_data == 1 && data[i].id == "2") {
                                                                        add = "<div class='" + class_name + "' style='width:60%;left:7%;font-size: 13px;border:1px solid green;background: " + color + ";'>";
                                                                        first_situation_card_data = 0;
                                                                }
                                                                else
                                                                        add = "<div class='" + class_name + "' style='width:60%;left:7%;font-size: 13px;border:1px solid green;border-top:0px solid green;background: " + color + ";'>";

                                                                add += set_history_data(data[i], "all");
                                                                add += '<br><center><input type="button" value="再利用" onclick="reuse_select(' + data[i].num + ')"></center></div >';
                                                                if (data[i].id == "2")
                                                                        $("#reuse_situation_select_add").append(add);
                                                                else if (data[i].id == "3")
                                                                        $("#reuse_human_select_add").append(add);


                                                                //履歴の一部
                                                                if (i == data.length - 1) {
                                                                        add = "<div class='" + class_name + "' style='width:100%;height:15%;left:-3.5%;font-size: 13px;border:1px solid green;background: " + color + ";'>";
                                                                        add += set_history_data(data[i], "part") + "</div > ";
                                                                        $("#situation_box_add").append(add);
                                                                } else if (i > data.length - 6) {
                                                                        add = "<div class='" + class_name + "' style='width:100%;height:15%;left:-3.5%;font-size: 13px;border:1px solid green;border-top:0px solid green;background: " + color + ";'>";
                                                                        add += set_history_data(data[i], "part") + "</div > ";
                                                                        $("#situation_box_add").append(add);
                                                                }

                                                        }
                                                },
                                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                        // alert('エラーです！'); //エラーを表示
                                                        console.log("えらー:" + textStatus);
                                                }
                                        });
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                        // alert('エラーです！'); //エラーを表示
                                        console.log("えらー:" + textStatus);
                                }
                        });
                }

                function set_history_data(data, h) {
                        var sentence = "";
                        switch (data.id) {
                                case "2":
                                        sentence += "【状況カード】" + data.data4 + " <br> " + data.data1;
                                        if (data.data3 != "") {
                                                var image = '"' + data.data3 + '"';
                                                if (h == "all") {
                                                        sentence += "<br>" + "<a href='#!' onclick='exchange_history_image_not_view(" + image + ")' id='" + data.data3 + "_not_view' style='display: none;'class='square_btn'>画像を非表示</a>";
                                                        sentence += "<a href='#!' onclick='exchange_history_image_view(" + image + ")' id='" + data.data3 + "_view_all' class='square_btn'>画像を表示</a>";
                                                        sentence += '<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data.data3 + '.jpeg" id="' + data.data3 + '" style="display: none;">';
                                                } else if (h == "part") {
                                                        sentence += "<br>" + "<a href='#!' onclick='exchange_part_history_image_view(" + image + ")' id='" + data.data3 + "_view_part' class='square_btn'>画像を表示</a>";
                                                        document.getElementById("history_image_detail_box_img").src = "http://192.168.0.159/2018grade4/HUG/HUG_Server/image/" + data.data3 + ".jpeg";
                                                }
                                        }
                                        break;
                                case "3":
                                        sentence += "【人間カード】" + data.data4 + " <br> ";
                                        sentence += data.data3 + "&nbsp;&nbsp;" + data.data2 + "<br>" + data.data1;
                                        break;
                        }
                        return sentence;
                }

                //ID指定のデータの受信
                function get_id_data(get_id) {
                        if (DEBUG)
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                code: window.sessionStorage.getItem(["eventcode"]),
                                                id: get_id
                                        },
                                        success: function (data) {
                                                return data;
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                                console.log("えらー:" + textStatus);
                                        }
                                });
                        return null;
                }

                //履歴上にある画像の表示
                function exchange_history_image_view(image_id) {

                        document.getElementById(image_id + "_view_all").style.display = "none";
                        document.getElementById(image_id + "_not_view").style.display = "";
                        document.getElementById(image_id).style.display = "";
                }

                //一部の履歴上にある画像の表示
                function exchange_part_history_image_view() {
                        overview("on", "4")
                        // document.getElementById("black_box").style.display = "";
                        // document.getElementById("history_image_detail_box").style.display = "";
                }

                //履歴上にある画像の非表を切り替え
                function exchange_history_image_not_view(image_id) {
                        document.getElementById(image_id).style.display = "none";
                        document.getElementById(image_id + "_view_all").style.display = "";
                        document.getElementById(image_id + "_not_view").style.display = "none";
                }
        </script>
</head>

<body>
        <br>
        <br>
        <br>
        <!-- 新規・再利用 切り替えボタン-->
        <a href="#!" class="tag_r" onclick="exchange_mode('new')" id="new_button">新規</a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a href="#!" class="tag_b" onclick="exchange_mode('reuse')" id="reuse_button">再利用</a>
        </b>
        <b style="position: relative;left:8%;">

                <!-- カード切り替え -->
                <form id="target" class="cp_ipradio">
                        <input name="cpipr03" id="new_situation" type="radio" value="a" onclick='exchange_card("situation")'
                                checked> <label for="new_situation">状況カード</label>
                        <input name="cpipr03" id="new_human" type="radio" value="b" onclick='exchange_card("human")'>
                        <label for="new_human">人間カード</label>
                </form>
        </b>
        <!-- <br>
        <br> -->
        <!-- テーマボタン -->
        <div class="theme_box" style="height:20px;width: 100px;top:80px">
                <center>
                        <a href='#!' onclick='overview("on", "1")' class='square_btn'>テーマ確認</a>
                </center>
        </div>
        <!-- 概要一部 -->
        <div class="theme_box" style="top: 130px;">
                【概要】<br> 現在時刻
                <br> 経過時間
                <br>
                <center>
                        <a href='#!' onclick='overview("on", "2")' class='square_btn'>詳細</a></center>
        </div>
        <!-- 履歴一部 -->
        <div class="theme_box" style="top:270px;height:55%;">
                【履歴】
                <br>
                <a id="situation_box_add"></a>
                <center>
                        <a href='#!' onclick='overview("on", "3")' class='square_btn'>すべて表示</a>
                </center>
        </div>


        <!-- 半透明の黒 -->
        <div class="hide_black" id="black_box" style="display: none;" onclick='overview("off")'></div>
        <!-- 履歴一部上の画像表示 -->
        <div class="theme_box" id="history_image_detail_box" style="display: none;width: auto;height: auto;position: absolute;top: 20%;left: 17%;z-index: 1;">
                <center> <a href='#!' onclick='overview("off")' class='square_btn'>閉じる</a></center>
                <img src="" id="history_image_detail_box_img">
        </div>
        <!-- テーマ内容 -->
        <div class="theme_box" id="theme_detail_box" style="display: none;width: auto;height: auto;position: absolute;top: 20%;left: 17%;z-index: 1;">

                <center> <a href='#!' onclick='overview("off")' class='square_btn'>閉じる</a></center>
                タイトル
                <draw_area id="theme_title_text" style="position: relative;left: 50px;"></draw_area>
                <br> カテゴリー
                <draw_area id="theme_category_text" style="position: relative;left: 35px;"></draw_area>
                <br> 状況
                <draw_area id="theme_situation_text" style="position: relative;left: 83px;"></draw_area>
                <br> 評価項目
                <draw_area id="theme_assessment_text" style="position: relative;left: 50px;"></draw_area>
                <br> 日時/時期
                <draw_area id="theme_time_text" style="position: relative;left: 50px;"></draw_area>
                <br> 地域
                <draw_area id="theme_area_text" style="position: relative;left: 90px;"></draw_area>

                <br>
                対象者
                <draw_area id="theme_target_text" style="position: relative;left: 70px;"></draw_area>
                <br> ねらい
                <draw_area id="theme_aim_text" style="position: relative;left: 70px;"></draw_area>
                <br> 画像<br>
                <div id="theme_image_text" style="position: relative;left: 0px;"></div>
        </div>
        <!-- 概要詳細 -->
        <div class="theme_box" id="overview_detail_box" style="display: none;width: 60%;height: 50%;position: absolute;top: 20%;left: 17%;z-index: 1;">
                【概要詳細】
                <center> <a href='#!' onclick='overview("off")' class='square_btn'>閉じる</a></center>

        </div>
        <!-- 履歴詳細 -->
        <div class="theme_box" id="situation_detail_box" style="display: none;width: 80%;height: auto;position: absolute;top: 8%;left: 8%;z-index: 1;">
                【履歴詳細】
                <br>
                <center> <a href='#!' onclick='overview("off")' class='square_btn'>閉じる</a></center>
                <br><a id="situation_detail_box_add"></a>
                <!-- <div class="block1" style="width:100%;left:-1%;font-size: 13px;background: #f7fdc4;">
                        時間<br> 文
                        <br>章
                </div>
                <div class="block2" style="width:100%;left:-1%;font-size: 13px;background: #fff8ef;">
                        時間<br> 文
                        <br>章
                </div> -->


        </div>
        <!-- 状況カード -->
        <a id="situation_card">
                <form id="input1">
                        <!-- 状況 -->
                        <div class="block1">
                                <text_and_pop id="situation_input_text" title="発生した状況の詳細を入力してください" style="position: relative;top:-30px;">状況*
                                        <b style="font-size: 10px;">(100字以内)</b>
                                </text_and_pop>
                                <textarea id="situation" maxlength='100' class="textarea_smoll" style="position: relative; left:0px;top:-30%;"
                                        wrap="soft" required></textarea>
                        </div>
                        <!-- 評価項目 -->
                        <div class="block2">
                                <text_and_pop id="assessment_input_text" title="評価項目についてどれくらい関連度があるか入力して下さい">評価項目*</text_and_pop>
                                <assessment_list id="assessment_list"></assessment_list>
                        </div>
                </form>

                <!-- 画像 -->
                <div class="block1" id="input0">
                        <text_and_pop title="施設内の地図など避難所に関する画像を選択してください">画像</text_and_pop>

                        <form id="file_input" action="http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php"
                                method="post" enctype="multipart/form-data">
                                <!-- <br> -->
                                <input type="file" name="pic" id="image_file" style="position: relative; left:128px;top:-20px;"
                                        onchange="image_update()">
                                <!-- <br> -->
                        </form>
                        <div id="image_input_draw"></div>
                </div>
                <b style="position: relative; left:36%;">
                        <input type="button" value="次へ" onclick='next("situation")'>
                </b>
        </a>
        <!-- 人間カード -->
        <a id="human_card" style="display: none;">
                <form id="input_human">
                        <!-- 特徴 -->
                        <div class="block1">
                                <text_and_pop id="feature_input_text" title="けがや体調などわかることを記入してください" style="position: relative;top:-30px;">特徴*
                                        <b style="font-size: 10px;">(100字以内)</b>
                                </text_and_pop>
                                <textarea id="feature" maxlength='100' class="textarea_smoll" wrap="soft" style="position: relative; left:0px;top:-30%;"
                                        required></textarea>
                                <!-- <input type="text" id="feature" class="textarea_smoll" required> -->
                        </div>
                        <!-- 年 -->
                        <div class="block2">
                                <text_and_pop id="age_input_text" title="年齢がわからない場合はおよそを記入して下さい">年齢*</text_and_pop>
                                <input type="text" id="age" class="textarea_smoll" style="height:20px;" required>
                        </div>
                        <div class="block1">
                                <text_and_pop id="sex_input_text">性別*</text_and_pop>

                                <b style="position: relative; left:60px;">
                                        <input type="radio" name="sex" value="男性">男性
                                        <input type="radio" name="sex" value="女性">女性
                                </b>
                        </div>
                </form>
                <b style="position: relative; left:36%;">
                        <input type="button" value="次へ" onclick='next("human")'>
                </b>
        </a>
        <script>
                // 画像が選択されたら表示
                function image_update() {
                        var file = document.getElementById("image_file").files;
                        var reader = new FileReader();
                        reader.readAsDataURL(file[0]); //dataURL形式でファイルを読み込む

                        reader.onload = function () {//ファイルの読込が終了した時の処理
                                var dataUrl = reader.result;

                                //読み込んだ画像の表示（入力画面、確認画面）
                                document.getElementById("image_input_draw").innerHTML = "<br><center><img src='" + dataUrl + "'></center>";
                                document.getElementById("image_draw").innerHTML = "<br><center><img src='" + dataUrl + "'></center>";

                                // ファイル名のみ取得して表示します
                                var selectFileSample4 = document.getElementById("image_file").value;
                                var regex = /\\|\\/;
                                var array = selectFileSample4.split(regex);

                                image_send = array[array.length - 1];
                                image_send = image_send.split(".")[1];
                        }
                };
        </script>
        <!-- <form id="error"> -->
        <!-- <b style="position: relative; left:26%;"> -->
        <!-- エラーメッセージ -->
        <a id="required_error" style="position: relative; left:26%;color: red;display: none;">
                <br>入力内容に不備があります。
                <br>
                <br>
        </a>
        <!-- </b> -->
        <!-- <b style="position: relative; left:36%;">
                        <input type="button" value="次へ" onclick="next()">
                </b> -->
        <!-- </form> -->
        <!-- 状況作成時の確認画面 *************************************************************-->
        <form id="confirm_situation" style="display: none;">
                <div class="block1" id="situation">
                        状況*<br>
                        <draw_area id="situation_text"></draw_area>
                </div>

                <div class="block2">
                        評価項目*
                        <draw_area id="assessment_text"></draw_area>
                </div>
                <div class="block1">
                        画像
                        <div id="image_draw"></div>

                </div>
                <br>
                <a style="position: relative; left:27%;">
                        <!-- ボタン -->
                        <input type="button" value="訂正" onclick='back("situation")'> &nbsp; &nbsp; &nbsp; &nbsp;
                        <input type="button" value="内容確定" onclick='decide("situation")'>
                </a>
        </form>
        <!-- 人間カード作成時の確認画面 *************************************************************-->
        <form id="confirm_human" style="display: none;">
                <div class="block1" id="feature">
                        特徴*
                        <draw_area id="feature_text"></draw_area>
                </div>

                <div class="block2">
                        年齢*
                        <draw_area id="age_text"></draw_area>
                </div>
                <div class="block1">
                        性別*
                        <draw_area id="sex_text"></draw_area>

                </div>
                <br>
                <a style="position: relative; left:27%;">
                        <!-- ボタン -->
                        <input type="button" value="訂正" onclick='back("human")'> &nbsp; &nbsp; &nbsp; &nbsp;
                        <input type="button" value="内容確定" onclick='decide("human")'>
                </a>
        </form>
        <!-- 状況カード再利用****************************************************************************** -->
        <reuse_situation_card id="reuse_situation_card" style="display:none;">
                <reuse_situation_select_add id="reuse_situation_select_add">

                </reuse_situation_select_add>
        </reuse_situation_card>
        <!-- 人間カード再利用****************************************************************************** -->
        <reuse_human_card id="reuse_human_card" style="display:none;">
                <reuse_human_select_add id="reuse_human_select_add">

                </reuse_human_select_add>
        </reuse_human_card>
        <script>
                var assessment_send = [], category_send, time_send = "", image_send = "";//登録時に送信する用
                var mode = "new";//新規作成か再利用の識別変数
                //次へボタンが押された時
                function next(h) {
                        var required_flag = true;//入力必須事項の確認用

                        if (h == "situation") {
                                var get1 = document.forms.input1;

                                error_reset();
                                // 状況
                                $("#situation_text").empty();
                                $("#situation_text").append(get1.situation.value);
                                if (get1.situation.value == "") {
                                        required_flag = false;
                                        document.getElementById("situation_input_text").style.color = "red";
                                }

                                // 評価項目
                                $("#assessment_text").empty();
                                for (var i = 0; i < assessment_data.length; i++) {
                                        if (i != 0)
                                                $("#assessment_text").append('<a style="position: relative;left: 135px;">' + assessment_data[i] + "：" + document.getElementById("assessment_list" + i).value + '</a>');
                                        else
                                                $("#assessment_text").append('<a style="position: relative;left: 36px;">' + assessment_data[i] + "：" + document.getElementById("assessment_list" + i).value + '</a>');
                                        $("#assessment_text").append("<br>");
                                        assessment_send.push(document.getElementById("assessment_list" + i).value);
                                }



                                // 入力必須事項の確認
                                if (required_flag == true) {
                                        document.getElementById("required_error").style.display = "none";
                                        document.getElementById("situation_card").style.display = "none";
                                        document.getElementById("confirm_situation").style.display = "";
                                        document.getElementById("required_error").style.display = "none";

                                }
                                else {
                                        document.getElementById("required_error").style.display = "";

                                }
                        }
                        else if (h == "human") {
                                var get1 = document.forms.input_human;
                                $("#feature_text").empty();
                                $("#feature_text").append(get1.feature.value);
                                if (get1.feature.value == "") {
                                        required_flag = false;
                                        document.getElementById("feature_input_text").style.color = "red";
                                }
                                $("#age_text").empty();
                                $("#age_text").append(get1.age.value);
                                if (get1.age.value == "") {
                                        required_flag = false;
                                        document.getElementById("age_input_text").style.color = "red";
                                }


                                $("#sex_text").empty();
                                $("#sex_text").append(get1.sex.value);
                                if (get1.sex.value == "") {
                                        required_flag = false;
                                        document.getElementById("sex_input_text").style.color = "red";
                                }


                                // 入力必須事項の確認
                                if (required_flag == true) {
                                        document.getElementById("required_error").style.display = "none";
                                        document.getElementById("human_card").style.display = "none";
                                        document.getElementById("confirm_human").style.display = "";
                                        document.getElementById("required_error").style.display = "none";
                                }
                                else {
                                        document.getElementById("required_error").style.display = "";
                                }
                        }
                }

                //訂正ボタンが押された
                function back(h) {
                        if (h == "situation") {
                                document.getElementById("situation_card").style.display = "";
                        }
                        else if (h == "human") {
                                document.getElementById("human_card").style.display = "";
                        }
                        document.getElementById("required_error").style.display = "";
                        document.getElementById("confirm_situation").style.display = "none";
                        document.getElementById("confirm_human").style.display = "none";
                        document.getElementById("required_error").style.display = "none";
                }

                var send_f = 1;
                //内容確定ボタンが押された
                function decide(h) {
                        if (h == "situation") {
                                var get1 = document.forms.input1;
                                var file_name = "";
                                var form = document.getElementById("file_input");
                                var a = document.getElementById("image_file");
                                alert(a.value);
                                if (a.value != "")
                                        file_name = window.sessionStorage.getItem(["eventcode"]);
                                if (send_f == 1) {
                                        send_f = 0;
                                        $.ajax({ //非同期通信
                                                type: "POST",
                                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                                data: {
                                                        data1: get1.situation.value,
                                                        data2: assessment_send.join("/"),
                                                        data3: file_name,
                                                        data4: "21:20",
                                                        code: window.sessionStorage.getItem(["eventcode"]),
                                                        mode: "insert",
                                                        id: 2
                                                },
                                                success: function (data) {
                                                        console.log(data);
                                                        alert(data);
                                                        data = data.split("/");
                                                        if (data[1] != "")
                                                                file(data[1]);
                                                        if (data[0] == "ok") {
                                                                window.location.href = "pm.html";
                                                        }
                                                        else {
                                                                alert("ok以外");
                                                        }
                                                        send_f = 1;
                                                },
                                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                        // alert('エラーです！'); //エラーを表示
                                                        send_f = 1;
                                                        console.log("えらー:" + textStatus);
                                                }
                                        });
                                }
                        }
                        else if (h == "human") {
                                if (send_f == 1) {
                                        var get2 = document.forms.input_human;

                                        send_f = 0;
                                        $.ajax({ //非同期通信
                                                type: "POST",
                                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                                data: {
                                                        data1: get2.feature.value,
                                                        data2: get2.age.value,
                                                        data3: get2.sex.value,
                                                        data4: "21:20",
                                                        code: window.sessionStorage.getItem(["eventcode"]),
                                                        mode: "insert",
                                                        id: 3
                                                },
                                                success: function (data) {
                                                        if (data == "ok") {
                                                                // window.location.href = "pm.html";
                                                                exchange_mode("new");
                                                        }
                                                        else {
                                                                alert("ok以外");
                                                        }
                                                        send_f = 1;
                                                },
                                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                        // alert('エラーです！'); //エラーを表示
                                                        console.log("えらー:" + textStatus);
                                                        send_f = 1;
                                                }
                                        });
                                }
                        }
                }
                function file(num) {
                        var form = document.getElementById("file_input");
                        var formdata = new FormData(form);
                        // console.log();
                        // if (form != "")
                        $.ajax({
                                type: 'POST',
                                url: 'http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php?code=' + window.sessionStorage.getItem(["eventcode"]) + '&&num=' + num,
                                data: formdata,
                                processData: false,	// jQueryがデータを処理しないように設定
                                contentType: false,	// jQueryがcontentTypeを設定しないように設定
                                error: function (data) {
                                        // console.log("error:" + data);
                                        // alert("error:" + data);
                                }
                        });
                }



                function overview(h, n) {
                        if (h == "on") {
                                document.getElementById("black_box").style.display = "";
                                if (n == "1")
                                        document.getElementById("theme_detail_box").style.display = "";
                                else if (n == "2")
                                        document.getElementById("overview_detail_box").style.display = "";
                                else if (n == "3")
                                        document.getElementById("situation_detail_box").style.display = "";
                                else if (n == "4")
                                        document.getElementById("history_image_detail_box").style.display = "";
                        } else if (h == "off") {
                                document.getElementById("black_box").style.display = "none";
                                document.getElementById("theme_detail_box").style.display = "none";
                                document.getElementById("overview_detail_box").style.display = "none";
                                document.getElementById("situation_detail_box").style.display = "none";
                                document.getElementById("history_image_detail_box").style.display = "none";

                        }

                }

                //エラー系のリセット
                function error_reset() {
                        document.getElementById("required_error").style.display = "none";
                        document.getElementById("situation_input_text").style.color = "";
                        document.getElementById("feature_input_text").style.color = "";
                        document.getElementById("age_input_text").style.color = "";
                        document.getElementById("sex_input_text").style.color = "";
                }

                //作成する種類の変更
                function exchange_card(h) {
                        error_reset();
                        document.getElementById("confirm_situation").style.display = "none";
                        document.getElementById("confirm_human").style.display = "none";
                        if (mode == "new")
                                switch (h) {
                                        case "human":
                                                document.getElementById("situation_card").style.display = "none";
                                                document.getElementById("human_card").style.display = "";
                                                break;
                                        case "situation":
                                                document.getElementById("situation_card").style.display = "";
                                                document.getElementById("human_card").style.display = "none";
                                                break;
                                }
                        else if (mode == "reuse")
                                switch (h) {
                                        case "human":
                                                document.getElementById("reuse_situation_card").style.display = "none";
                                                document.getElementById("reuse_human_card").style.display = "";
                                                break;
                                        case "situation":
                                                document.getElementById("reuse_situation_card").style.display = "";
                                                document.getElementById("reuse_human_card").style.display = "none";
                                                break;
                                }
                }

                //新規・再利用の切り替え
                function exchange_mode(h) {
                        document.getElementById("situation_card").style.display = "none";
                        document.getElementById("human_card").style.display = "none";
                        document.getElementById("reuse_situation_card").style.display = "none";
                        document.getElementById("reuse_human_card").style.display = "none";
                        var element = document.getElementById("target");
                        mode = h;
                        if (element.cpipr03[0].checked == true) {
                                exchange_card("situation");
                        } else if (element.cpipr03[1].checked == true) {
                                exchange_card("human");
                        }
                        switch (h) {
                                case "new":
                                        document.getElementById("new_button").className = "tag_r";
                                        document.getElementById("reuse_button").className = "tag_b";
                                        break;
                                case "reuse":
                                        document.getElementById("new_button").className = "tag_b";
                                        document.getElementById("reuse_button").className = "tag_r";
                                        break;
                        }

                }

                function reuse_select(select_num) {

                        $.ajax({ //非同期通信
                                type: "POST",
                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                data: {
                                        code: window.sessionStorage.getItem(["eventcode"]),
                                        num: select_num
                                },
                                success: function (data) {
                                        console.log(data);
                                        if (data[0].id == "2") {
                                                var get1 = document.forms.input1;
                                                get1.situation.value = data[0].data1;
                                                data[0].data2 = data[0].data2.split("/");
                                                for (var i = 0; i < assessment_data[0].length; i++) {
                                                        document.getElementById("assessment_list" + i).value = data[0].data2[i];
                                                }
                                                exchange_mode("new");
                                        }
                                        else if (data[0].id == "3") {
                                                var get1 = document.forms.input_human;
                                                get1.feature.value = data[0].data1;
                                                get1.age.value = data[0].data2;
                                                get1.sex.value = data[0].data3;
                                                exchange_mode("new");
                                        }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                        // alert('エラーです！'); //エラーを表示
                                        console.log("data");
                                }
                        });
                }
        </script>

</body>

</html>