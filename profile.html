<!DOCTYPE html>
<html>

<head>
        <meta charset="UTF-8" />
        <title>ホーム</title>
        <link rel="stylesheet" type="text/css" href="header.css">
        <script type="text/javascript" src="menu.js"> </script>
        <script src="https://code.jquery.com/jquery-1.9.0.min.js"></script>

</head>

<body>
        <script type="text/javascript">
                write_header(4);
        </script>

        <br>
        <br>
        <form id="input">
                ユーザー名
                <input type="text" id="name" style="position: relative; left:30px;" class="" value="">
                <script>
                        document.forms.input.name.value = window.sessionStorage.getItem(["name"]);
                </script>
                <br>
                <br> パスワード &nbsp;&nbsp;&nbsp;&nbsp;現在のパスワード
                <input type="text" id="now_password" style="position: relative; left:80px;" class="">
                <a style="position: relative; left:108px;">
                        <br>新しいパスワード
                        <input type="text" id="new_password1" class="" style="position: relative; left:80px;">
                        <br>新しいパスワード（確認用）
                        <input type="text" id="new_password2" class="">
                </a>
                <br>
                <br>
                <div style="text-align: center">
                        <input type="button" id="sort_day" style="position: relative; left:50px;" value="変更" onclick='profile_updata()'>
                </div>
                <error style="color: red;"></error>
        </form>
        <br>
        <script>

                //ユーザーの情報を更新
                function profile_updata() {
                        var get = document.forms.input;
                        var flag = 0;
                        // alert(get.name.value + "::" + new_password1.value);
                        if (get.now_password.value == "" && get.new_password1.value == "" && get.new_password2.value == "" && get.name.value == "") {
                                $("error").empty();
                                $("error").append("入力情報が不足しています");
                        } else if (get.now_password.value == "" && get.new_password1.value == "" && get.new_password2.value == "" && get.name.value != "") {
                                $("error").empty();
                                flag = 1;
                        } else if ((get.now_password.value == "" || get.new_password1.value == "" || get.new_password2.value == "") && get.name.value != "") {
                                $("error").empty();
                                $("error").append("入力情報が不足しています");
                        } else if (get.new_password1.value != get.new_password2.value) {
                                $("error").empty();
                                $("error").append("新しいパスワードが一致しません");
                        }
                        if (flag == 1)
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/profile_updata.php",
                                        data: {
                                                mail: window.sessionStorage.getItem(["mail"]),
                                                name: get.name.value,
                                                now_pass: get.now_password.value,
                                                new_pass: get.new_password1.value
                                        },
                                        success: function (data) {
                                                // alert(data);
                                                window.location.href = "profile.html";
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                        }
                                });

                }
        </script>
</body>

</html>