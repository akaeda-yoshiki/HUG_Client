<!DOCTYPE html>
<html>

<head>
        <meta charset="UTF-8" />
        <title>プレイ画面</title>
        <link rel="stylesheet" type="text/css" href="play.css">
        <script type="text/javascript" src="define.js"> </script>
        <script src="https://code.jquery.com/jquery-1.9.0.min.js"></script>
        <script type="text/javascript" src="jquery.balloon.js"></script>
        <script type="text/javascript" src="play_common.js"></script>
        <script type="text/javascript" src="figure.js"></script>
        <script type="text/javascript" src="ps.js"></script>
        <style type="text/css">
                canvas {
                        /* background: rgb(255, 255, 255); */
                        /* background: url(image.jpeg); */
                        background-size: cover;
                        border: 1px solid #999;
                        /* position: absolute;
                    top: 32px;
                    left: 8px; */

                }

                input[type=radio] {
                        display: none;
                        /* ラジオボタンを非表示にする */
                }

                input[type="radio"]:checked+label {
                        background: #31A9EE;
                        /* マウス選択時の背景色を指定する */
                        color: #ffffff;
                        /* マウス選択時のフォント色を指定する */
                }

                .label {
                        display: block;
                        /* ブロックレベル要素化する */
                        float: left;
                        /* 要素の左寄せ・回り込を指定する */
                        margin: 5px;
                        /* ボックス外側の余白を指定する */
                        width: 50px;
                        /* ボックスの横幅を指定する */
                        height: 30px;
                        /* ボックスの高さを指定する */
                        padding-left: 5px;
                        /* ボックス内左側の余白を指定する */
                        padding-right: 5px;
                        /* ボックス内御右側の余白を指定する */
                        color: #b20000;
                        /* フォントの色を指定 */
                        text-align: center;
                        /* テキストのセンタリングを指定する */
                        cursor: pointer;
                        /* マウスカーソルの形（リンクカーソル）を指定する */
                        border: 2px solid #006DD9;
                        /* ボックスの境界線を実線で指定する */
                        border-radius: 5px;
                        /* 角丸を指定する */
                }

                .label:hover {
                        background-color: rgb(142, 194, 250);
                        /* マウスオーバー時の背景色を指定する */
                }
        </style>
        <script>


                $('texi_and_pop').balloon();//マウスオーバーの割り当て

                var assessment_data = [];
                //受信
                $(document).ready(function () {
                        // window.sessionStorage.setItem(["eventcode"], "5SrgaP0MjG");
                        get_theme_detail();

                        var list = '<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>';

                        if (DEBUG) {
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                code: window.sessionStorage.getItem(["eventcode"])
                                        },
                                        success: function (data1) {
                                                // alert(data1);
                                                $.ajax({ //非同期通信
                                                        type: "POST",
                                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/theme.php",
                                                        data: {
                                                                id: data1
                                                        },
                                                        success: function (data) {
                                                                var text1 = '<br><a style="position: relative;left: 140px;">';
                                                                var text2 = '：</a><select id="assessment_list';
                                                                var text3 = '" style="position: relative;width: 50px;left: 158px;">';

                                                                var add = "";
                                                                add += '<a style="position: relative;left: 40px;">' + data[0].assessment0 + '：</a>';
                                                                add += '<select id="assessment_list' + 0 + '" style="position: relative;width: 50px;left: 60px;">';
                                                                $("#assessment_list").append(add + list);
                                                                assessment_data.push(data[0].assessment0);
                                                                if (data[0].assessment1 != "") { $("#assessment_list").append(text1 + data[0].assessment1 + text2 + 1 + text3 + list); assessment_data.push(data[0].assessment1); }
                                                                if (data[0].assessment2 != "") { $("#assessment_list").append(text1 + data[0].assessment2 + text2 + 2 + text3 + list); assessment_data.push(data[0].assessment2); }
                                                                if (data[0].assessment3 != "") { $("#assessment_list").append(text1 + data[0].assessment3 + text2 + 3 + text3 + list); assessment_data.push(data[0].assessment3); }
                                                                if (data[0].assessment4 != "") { $("#assessment_list").append(text1 + data[0].assessment4 + text2 + 4 + text3 + list); assessment_data.push(data[0].assessment4); }
                                                                if (data[0].assessment5 != "") { $("#assessment_list").append(text1 + data[0].assessment5 + text2 + 5 + text3 + list); assessment_data.push(data[0].assessment5); }
                                                                if (data[0].assessment6 != "") { $("#assessment_list").append(text1 + data[0].assessment6 + text2 + 6 + text3 + list); assessment_data.push(data[0].assessment6); }
                                                                if (data[0].assessment7 != "") { $("#assessment_list").append(text1 + data[0].assessment7 + text2 + 7 + text3 + list); assessment_data.push(data[0].assessment7); }
                                                                if (data[0].assessment8 != "") { $("#assessment_list").append(text1 + data[0].assessment8 + text2 + 8 + text3 + list); assessment_data.push(data[0].assessment8); }
                                                                if (data[0].assessment9 != "") { $("#assessment_list").append(text1 + data[0].assessment9 + text2 + 9 + text3 + list); assessment_data.push(data[0].assessment9); }

                                                        },
                                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                                // alert('エラーです！'); //エラーを表示
                                                                console.log("えらー:" + textStatus);
                                                        }
                                                });
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                        }
                                });

                                get_history();
                                setInterval(update, 500);
                                init();
                        }
                });


                //ID指定のデータの受信
                function get_id_data(get_id) {
                        if (DEBUG)
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                code: window.sessionStorage.getItem(["eventcode"]),
                                                id: get_id
                                        },
                                        success: function (data) {
                                                return data;
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                                console.log("えらー:" + textStatus);
                                        }
                                });
                        return null;
                }

        </script>
</head>

<body>
        <script>
                $(function () { $("#include_common").load("play_common.html"); })
        </script>

        <div id="include_common">
        </div>
        <br><br><br>
        <!-- 新規入力画面 *************************************************************-->
        <form id="cope_input" style="display: none;">
                <div class="block1" id="situation">
                        状況*<br>
                        <draw_area id="situation_text"></draw_area>
                </div>
                <div class="block2">
                        画像
                        <div id="image_draw"></div>

                </div>
                <!-- 対応 -->
                <div class="block1">
                        <text_and_pop id="cope_input_text" title="状況への対応を記入してください" style="position: relative;top:-30px;">対応*
                                <b style="font-size: 10px;">(100字以内)</b>
                        </text_and_pop>
                        <textarea id="cope" maxlength='100' class="textarea_smoll" wrap="soft" style="position: relative; left:0px;top:-30%;"
                                required></textarea>
                        <input type="button" value="エリアの操作する" id="area_operate_on_button" onclick='area_operate_swcth(true)'
                                style="position: relative;left: 130px;">
                        <input type="button" value="エリアの操作をやめる" id="area_operate_off_button" onclick='area_operate_swcth(false)'
                                style="display: none;position: relative;left: 130px;">
                </div>



                <br>
                <a style="position: relative; left:35%;">
                        <!-- ボタン -->
                        <input type="button" value="次へ" onclick='next("")'>
                </a>
        </form>
        <form id="cope_human_input" style="display: none;">
                <div class="block1" id="feature">
                        特徴*<br>
                        <draw_area id="feature_text"></draw_area>
                </div>
                <div class="block2">
                        年齢
                        <draw_area id="age_text"></draw_area>
                </div>
                <div class="block1">
                        性別*<br>
                        <draw_area id="sex_text"></draw_area>
                </div>
                <!-- 対応 -->
                <div class="block2">
                        <text_and_pop id="cope_input_human_text" title="状況への対応を記入してください" style="position: relative;top:-30px;">対応*
                                <b style="font-size: 10px;">(100字以内)</b>
                        </text_and_pop>
                        <textarea id="cope" maxlength='100' class="textarea_smoll" wrap="soft" style="position: relative; left:0px;top:-30%;"
                                required></textarea>
                        <input type="button" value="エリアの操作する" id="area_operate_on_button" onclick='area_operate_swcth(true)'
                                style="position: relative;left: 130px;">
                        <input type="button" value="エリアの操作をやめる" id="area_operate_off_button" onclick='area_operate_swcth(false)'
                                style="display: none;position: relative;left: 130px;">
                </div>



                <br>
                <a style="position: relative; left:35%;">
                        <!-- ボタン -->
                        <input type="button" value="次へ" onclick='next("_human")'>
                </a>
        </form>
        <datalist id="color_list">
                <option value="#ff0000">#ff0000</option>
                <option value="#00ff00">#00ff00</option>
                <option value="#0000ff">#0000ff</option>
        </datalist>
        <datalist id="label_text_list">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
        </datalist>
        <br>
        <!-- エリア操作画面 -->
        <div class="block1" id="area_operate" style="display: none;">
                <form id="select_figure">
                        <input type="radio" name="figure" value="□" id="rect">
                        <label for="rect" class="label">□</label>

                        <input type="radio" name="figure" value="〇" id="circle">
                        <label for="circle" class="label">〇</label>

                        <input type="radio" name="figure" value="△" id="triangle">
                        <label for="triangle" class="label">△</label>
                        <input type="radio" name="figure" value="no" id="no">

                </form>
                <form id="create_figure">

                        <br>
                        <br> 図形の色
                        <input type="color" name="figure_color" list="color_list" value="#00ff00">
                        <br> ラベル名
                        <input type="text" name="label_text" list="label_text_list" required>
                        <br>ラベルの色
                        <input type="color" name="label_color" list="color_list" value="#ff0000">

                        <br>
                        <input type="button" id="create" value="新規作成" onclick="create_figure()">
                        <input type="button" id="edit" value="変更" onclick="create_figure()">
                        <input type="button" value="削除" onclick="figure_delete()">

                </form>
                <br>
                <canvas id="canvas" width="400" height="400"></canvas>
        </div>
        <!-- 確認画面 *************************************************************-->
        <form id="confirm_cope" style="display: none;">
                <div class="block1" id="situation">
                        状況*<br>
                        <draw_area id="confirm_situation_text"></draw_area>
                </div>
                <div class="block2">
                        画像
                        <div id="confirm_image_draw"></div>

                </div>
                <div class="block1">
                        対応*<br>
                        <draw_area id="confirm_cope_text"></draw_area>
                </div>
                <div class="block2">
                        エリア画像*<br>
                        <draw_area id="confirm_area"></draw_area>
                </div>
                <br>
                <a style="position: relative; left:27%;">
                        <!-- ボタン -->
                        <input type="button" value="訂正" onclick='exchange_mode("input_situation")'> &nbsp; &nbsp;
                        &nbsp; &nbsp;
                        <input type="button" value="内容確定" onclick='decide("situation")'>
                </a>
        </form>
        <form id="confirm_human_cope" style="display: none;">
                <div class="block1" id="feature">
                        特徴*<br>
                        <draw_area id="confirm_feature_text"></draw_area>
                </div>
                <div class="block2">
                        年齢
                        <draw_area id="confirm_age_text"></draw_area>

                </div>
                <div class="block1">
                        性別*<br>
                        <draw_area id="confirm_sex_text"></draw_area>
                </div>
                <div class="block2">
                        対応*<br>
                        <draw_area id="confirm_cope_human_text"></draw_area>
                </div>
                <div class="block1">
                        エリア画像*<br>
                        <draw_area id="confirm_human_area"></draw_area>
                </div>
                <br>
                <a style="position: relative; left:27%;">
                        <!-- ボタン -->
                        <input type="button" value="訂正" onclick='exchange_mode("input_human")'> &nbsp; &nbsp; &nbsp;
                        &nbsp;
                        <input type="button" value="内容確定" onclick='decide("human")'>
                </a>
        </form>
        <!-- エラーメッセージ -->
        <a id="required_error" style="position: relative; left:26%;color: red;display: none;">
                <br>入力内容に不備があります。
                <br>
                <br>
        </a>
        <form id="file_input" action="http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php" method="post"
                enctype="multipart/form-data" style="display: none;">
                <!-- <br> -->
                <input type="file" name="pic" id="image_file" style="position: relative; left:128px;top:-20px;">
                <!-- <br> -->
        </form>
        <script>
                var now_situation_number = "";
                var assessment_send = [], category_send, time_send = "", image_send = "";//登録時に送信する用
                var mode = "new";//新規作成か再利用の識別変数
                //次へボタンが押された時
                function next(h) {
                        var required_flag = true;//入力必須事項の確認用
                        var get1;
                        if (h == "_human")
                                get1 = document.forms.cope_human_input;
                        else
                                get1 = document.forms.cope_input;

                        $("#confirm_cope" + h + "_text").empty();
                        $("#confirm_cope" + h + "_text").append(get1.cope.value);

                        $("#confirm" + h + "_area").empty();
                        if (document.getElementById("area_operate_on_button").style.display == "none") {
                                var img = new Image("image/jpeg");
                                img.src = document.getElementById('aaa').src;
                                figure_ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                                canvas_image = canvas.toDataURL();

                                $("#confirm" + h + "_area").append('<img id="confirm_area_image" src="' + canvas_image + '">');
                        }
                        else
                                $("#confirm" + h + "_area").append('変更なし');
                        if (get1.cope.value == "") {
                                document.getElementById("required_error").style.display = "";
                                document.getElementById("cope_input" + h + "_text").style.color = "red";
                        }
                        else {
                                error_reset();
                                if (h == "_human")
                                        exchange_mode("confirm_human");
                                else
                                        exchange_mode("confirm_situation");
                        }
                }


                var send_f = 1;
                //内容確定ボタンが押された
                function decide(h) {
                        // document.getElementById("image_file").value = canvas_image;
                        var get1
                        if (h == "situation")
                                get1 = document.forms.cope_input;
                        else if (h == "human")
                                get1 = document.forms.cope_human_input;


                        var file_name = "";
                        // console.log(now_situation_number);
                        // var form = document.getElementById("file_input");
                        // var a = document.getElementById("image_file");
                        // alert(a.value);
                        // if (a.value != "")
                        // file_name = window.sessionStorage.getItem(["eventcode"]);
                        if (send_f == 1) {
                                send_f = 0;
                                $.ajax({ //非同期通信
                                        type: "POST",
                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                        data: {
                                                data1: get1.cope.value,
                                                data2: now_situation_number,
                                                data3: file_name,
                                                data4: now_time,
                                                code: window.sessionStorage.getItem(["eventcode"]),
                                                mode: "insert",
                                                id: 4
                                        },
                                        success: function (data) {
                                                // alert(now_situation_number);
                                                data = data.split("/");
                                                $.ajax({ //非同期通信
                                                        type: "POST",
                                                        url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                                        data: {
                                                                data: "" + now_situation_number,
                                                                data1: "",
                                                                code: window.sessionStorage.getItem(["eventcode"]),
                                                                mode: "updata",
                                                                id: 4
                                                        },
                                                        success: function (data) {
                                                                // alert(data);
                                                        },
                                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                                // alert('エラーです！' + textStatus); //エラーを表示
                                                        }
                                                });
                                                // console.log(data);
                                                // alert(data);

                                                // if (file_name != "")
                                                file(data[1]);
                                                if (data[0] == "ok") {
                                                        // window.location.href = "ps.html";
                                                }
                                                else {
                                                        // alert("ok以外");
                                                }
                                                send_f = 1;
                                        },
                                        error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                                // alert('エラーです！'); //エラーを表示
                                                send_f = 1;
                                                console.log("えらー:" + textStatus);
                                        }
                                });
                        }
                }
                function file(num) {
                        // var form = document.getElementById("file_input");
                        // var formdata = new FormData(form);
                        // console.log();
                        // if (form != "")
                        // $.ajax({
                        //         type: 'POST',
                        //         url: 'http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php?code=' + window.sessionStorage.getItem(["eventcode"]) + '&&num=' + num,
                        //         data: canvas_image,
                        //         processData: false,	// jQueryがデータを処理しないように設定
                        //         contentType: false,	// jQueryがcontentTypeを設定しないように設定
                        //         error: function (data) {
                        //                 // console.log("error:" + data);
                        //                 alert("error:" + data);
                        //         }
                        // });

                        // $.ajax({ //非同期通信
                        //         type: "POST",
                        //         url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php",
                        //         data: {
                        //                 code: window.sessionStorage.getItem(["eventcode"]),
                        //                 num: num,
                        //                 image: canvas_image
                        //         },
                        //         success: function (data) {
                        //                 console.log(data);
                        //         },
                        //         error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                        //                 console.log("受信エラー");
                        //                 console.log("XMLHttpRequest::" + XMLHttpRequest);
                        //                 console.log("textStatus::" + textStatus);
                        //                 console.log("errorThrown::" + errorThrown);
                        //         }
                        // });
                        var data = {};
                        // 不要な情報を取り除く
                        canvas_image = canvas_image.replace(/^data:image\/png;base64,/, '');

                        data.image = canvas_image;
                        data.num = num;
                        data.code = window.sessionStorage.getItem(["eventcode"]);
                        $.ajax({
                                url: 'http://192.168.0.159/2018grade4/HUG/HUG_Server/file_upload.php',
                                type: 'POST',
                                success: function () {
                                        // 成功時の処理
                                        console.log(data);
                                },
                                error(jqXHR, textStatus, errorThrown) {
                                        // 失敗時の処理
                                },
                                data: data,
                                dataType: 'json'
                        });
                }





                //エラー系のリセット
                function error_reset() {
                        document.getElementById("required_error").style.display = "none";
                        document.getElementById("cope_input_text").style.color = "";
                }


                //新規・再利用の切り替え
                function exchange_mode(h) {

                        switch (h) {
                                case "input_situation":
                                        document.getElementById("cope_input").style.display = "";
                                        document.getElementById("cope_human_input").style.display = "none";
                                        document.getElementById("confirm_cope").style.display = "none";
                                        document.getElementById("confirm_human_cope").style.display = "none";
                                        if (document.getElementById("area_operate_on_button").style.display == "none")
                                                document.getElementById("area_operate").style.display = "";
                                        break;
                                case "input_human":
                                        document.getElementById("cope_input").style.display = "none";
                                        document.getElementById("cope_human_input").style.display = "";
                                        document.getElementById("confirm_cope").style.display = "none";
                                        document.getElementById("confirm_human_cope").style.display = "none";
                                        if (document.getElementById("area_operate_on_button").style.display == "none")
                                                document.getElementById("area_operate").style.display = "";
                                        break;
                                case "confirm_situation":
                                        document.getElementById("cope_input").style.display = "none";
                                        document.getElementById("cope_human_input").style.display = "none";
                                        document.getElementById("confirm_human_cope").style.display = "none";
                                        document.getElementById("confirm_cope").style.display = "";
                                        document.getElementById("area_operate").style.display = "none";
                                        break;
                                case "confirm_human":
                                        document.getElementById("cope_input").style.display = "none";
                                        document.getElementById("cope_human_input").style.display = "none";
                                        document.getElementById("confirm_human_cope").style.display = "";
                                        document.getElementById("confirm_cope").style.display = "none";
                                        document.getElementById("area_operate").style.display = "none";
                                        break;
                                case "none":
                                        document.getElementById("cope_input").style.display = "none";
                                        document.getElementById("confirm_cope").style.display = "none";
                                        break;
                        }
                }

                //履歴上にある画像の非表を切り替え
                function exchange_history_image_not_view1(image_id) {
                        document.getElementById(image_id).style.display = "none";
                        document.getElementById(image_id + "_view_all").style.display = "";
                        document.getElementById(image_id + "_not_view").style.display = "none";
                }
                //履歴上にある画像の表示
                function exchange_history_image_view1(image_id) {
                        // console.log(image_id + "");
                        document.getElementById(image_id + "_view_all").style.display = "none";
                        document.getElementById(image_id + "_not_view").style.display = "";
                        document.getElementById(image_id).style.display = "";
                }

                //新規状況対応
                function new_cope(h) {
                        // if ("16" == 0020)
                        // console.log(h + "");
                        error_reset();
                        $.ajax({ //非同期通信
                                type: "POST",
                                url: "http://192.168.0.159/2018grade4/HUG/HUG_Server/eventcode.php",
                                data: {
                                        code: window.sessionStorage.getItem(["eventcode"]),
                                        num: h
                                },
                                success: function (data) {
                                        now_situation_number = "" + data[0].num;

                                        if (data[0].id == 2) {
                                                // console.log(data);
                                                // 状況
                                                $("#situation_text").empty();
                                                $("#situation_text").append(data[0].data1);
                                                $("#confirm_situation_text").empty();
                                                $("#confirm_situation_text").append(data[0].data1);

                                                //画像
                                                if (data[0].id == "2" && data[0].data3 != "") {
                                                        // $("#image_draw").append('<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data[0].data3 + '.jpeg" id="situation' + data[0].data3 + '" style="display: none;">');

                                                        // var ima = "sit_" + data[0].data3;
                                                        // console.log(data[0].data3);
                                                        // var sentence = "<br>" + "<a href='#!' onclick='exchange_history_image_not_view1(" + ima + ")' id='sit_" + data[0].data3 + "_not_view' style='display: ;'class='square_btn'>画像を非表示</a>";
                                                        // sentence += "<a href='#!' onclick='exchange_history_image_view1(" + ima + ")' id='sit_" + data[0].data3 + "_view_all' class='square_btn'>画像を表示</a>";
                                                        // sentence += '<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data[0].data3 + '.jpeg" id="sit_' + data[0].data3 + '" style="display: ;">';

                                                        var image = '"' + data[0].data3 + '1"';
                                                        var sentence = "";
                                                        sentence += "<br>" + "<a href='#!' onclick='exchange_history_image_not_view1(" + image + ")' id='" + data[0].data3 + "1_not_view' style='display: none;'class='square_btn'>画像を非表示</a>";
                                                        sentence += "<a href='#!' onclick='exchange_history_image_view1(" + image + ")' id='" + data[0].data3 + "1_view_all' class='square_btn'>画像を表示</a>";
                                                        sentence += '<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data[0].data3 + '.jpeg" id="' + data[0].data3 + '1" style="display: none;">';
                                                        $("#image_draw").empty();
                                                        $("#image_draw").append(sentence);

                                                        image = '"' + data[0].data3 + '2"';
                                                        sentence = "<br>" + "<a href='#!' onclick='exchange_history_image_not_view1(" + image + ")' id='" + data[0].data3 + "2_not_view' style='display: none;'class='square_btn'>画像を非表示</a>";
                                                        sentence += "<a href='#!' onclick='exchange_history_image_view1(" + image + ")' id='" + data[0].data3 + "_view_all' class='square_btn'>画像を表示</a>";
                                                        sentence += '<img src="http://192.168.0.159/2018grade4/HUG/HUG_Server/image/' + data[0].data3 + '.jpeg" id="' + data[0].data3 + '2" style="display: none;">';
                                                        $("#confirm_image_draw").empty();
                                                        $("#confirm_image_draw").append(sentence);
                                                }
                                                else if (data[0].id == "2" && data[0].data3 == "") {
                                                        $("#image_draw").empty();
                                                        $("#image_draw").append("なし");
                                                        $("#confirm_image_draw").empty();
                                                        $("#confirm_image_draw").append("なし");
                                                }
                                                exchange_mode("input_situation");
                                        }
                                        else if (data[0].id == 3) {
                                                $("#feature_text").empty();
                                                $("#feature_text").append(data[0].data1);
                                                $("#confirm_feature_text").empty();
                                                $("#confirm_feature_text").append(data[0].data1);
                                                $("#age_text").empty();
                                                $("#age_text").append(data[0].data2);
                                                $("#confirm_age_text").empty();
                                                $("#confirm_age_text").append(data[0].data2);
                                                $("#sex_text").empty();
                                                $("#sex_text").append(data[0].data3);
                                                $("#confirm_sex_text").empty();
                                                $("#confirm_sex_text").append(data[0].data3);
                                                exchange_mode("input_human");
                                        }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) { //接続が失敗
                                        // alert('エラーです！'); //エラーを表示
                                        console.log("新規状況データ書き込みエラー");
                                }
                        });
                        area_operate_swcth(false);
                        overview("off");
                }

                //エリア操作のオンオフを変更
                function area_operate_swcth(h) {
                        if (h) {
                                draw_flag = true;
                                document.getElementById("area_operate_on_button").style.display = "none";
                                document.getElementById("area_operate_off_button").style.display = "";
                                document.getElementById("area_operate").style.display = "";
                        } else {
                                draw_flag = false;
                                document.getElementById("area_operate_on_button").style.display = "";
                                document.getElementById("area_operate_off_button").style.display = "none";
                                document.getElementById("area_operate").style.display = "none";
                        }
                }
                var debug = false;//通信のオンオフ（１：オフ）
                var draw_flag = false;
                if (debug == true)
                        var mynumber = sessionStorage.getItem('mynumber') - 1;//自分のユーザーIDを取得
                else
                        mynumber = 1;
                document.write(mynumber);
                var ev;
                var figure_info = [];//図形の情報
                var canvas = document.getElementById("canvas");
                var figure_ctx = canvas.getContext("2d");
                var size_change_marker = {//図形を拡大縮小可能時に表示されるマーカー
                        place: {
                                x: -10,
                                y: -10,
                                width: 8,
                                height: 8
                        },
                        color: "blue",
                        ctx: canvas.getContext("2d")
                };
                var rectx = 0, recty = 0;
                var myedit = -1;//現在選択している図形のID
                var mousex = 0, mousey = 0;//画面上のマウスの座標
                var imag_mousex, imag_mousey;//図形範囲内でのマウスの座標
                var change_flag = 0;
                var canvas_image;



        </script>

</body>

</html>